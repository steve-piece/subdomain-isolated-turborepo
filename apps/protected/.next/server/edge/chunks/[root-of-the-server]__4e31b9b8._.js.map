{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/protected/middleware.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from 'next/server';\n\nfunction extractSubdomain(request: NextRequest): string | null {\n  const url = request.url;\n  const host = request.headers.get('host') || '';\n  const hostname = host.split(':')[0];\n\n  // Local development environment\n  if (url.includes('localhost') || url.includes('127.0.0.1')) {\n    const fullUrlMatch = url.match(/http:\\/\\/([^.]+)\\.localhost/);\n    if (fullUrlMatch && fullUrlMatch[1]) {\n      return fullUrlMatch[1];\n    }\n    if (hostname.includes('.localhost')) {\n      return hostname.split('.')[0];\n    }\n    return null;\n  }\n\n  // Production: trust DNS and host; this app sits on app domain with wildcard\n  const parts = hostname.split('.');\n  if (parts.length > 2) {\n    return parts[0];\n  }\n  return null;\n}\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const subdomain = extractSubdomain(request);\n\n  if (subdomain) {\n    // If already under /s, pass through\n    if (pathname === '/s' || pathname.startsWith('/s/')) {\n      return NextResponse.next();\n    }\n\n    // Redirect root to show visible /s\n    if (pathname === '/') {\n      const url = new URL(`/s`, request.url);\n      return NextResponse.redirect(url);\n    }\n\n    // Rewrite other paths under /s\n    const targetPath = `/s${pathname}`;\n    return NextResponse.rewrite(new URL(targetPath, request.url));\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/((?!api|_next|[\\\\w-]+\\\\.\\\\w+).*)']\n};\n\n\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,SAAS,iBAAiB,OAAoB;IAC5C,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAC5C,MAAM,WAAW,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE;IAEnC,gCAAgC;IAChC,IAAI,IAAI,QAAQ,CAAC,gBAAgB,IAAI,QAAQ,CAAC,cAAc;QAC1D,MAAM,eAAe,IAAI,KAAK,CAAC;QAC/B,IAAI,gBAAgB,YAAY,CAAC,EAAE,EAAE;YACnC,OAAO,YAAY,CAAC,EAAE;QACxB;QACA,IAAI,SAAS,QAAQ,CAAC,eAAe;YACnC,OAAO,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;QAC/B;QACA,OAAO;IACT;IAEA,4EAA4E;IAC5E,MAAM,QAAQ,SAAS,KAAK,CAAC;IAC7B,IAAI,MAAM,MAAM,GAAG,GAAG;QACpB,OAAO,KAAK,CAAC,EAAE;IACjB;IACA,OAAO;AACT;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,YAAY,iBAAiB;IAEnC,IAAI,WAAW;QACb,oCAAoC;QACpC,IAAI,aAAa,QAAQ,SAAS,UAAU,CAAC,QAAQ;YACnD,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;QAC1B;QAEA,mCAAmC;QACnC,IAAI,aAAa,KAAK;YACpB,MAAM,MAAM,IAAI,IAAI,CAAC,EAAE,CAAC,EAAE,QAAQ,GAAG;YACrC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,+BAA+B;QAC/B,MAAM,aAAa,CAAC,EAAE,EAAE,UAAU;QAClC,OAAO,6LAAA,CAAA,eAAY,CAAC,OAAO,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;IAC7D;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAoC;AAChD"}}]
}